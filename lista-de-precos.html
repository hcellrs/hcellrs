<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Tabela de Pre√ßos - HCELL</title>
	
	<link rel="icon" type="image/x-icon" href="images/favicon.png">

	<style>
		body {
			font-family: Arial, sans-serif;
			background-color: #f0f2f5;
			padding: 20px;
			color: #333;
		}
		.container {
			max-width: 600px;
			margin: 0 auto;
			background-color: #ffffff;
			padding: 20px;
			border-radius: 8px;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
		}
		h1 {
			text-align: center;
			color: #1a73e8;
			margin-bottom: 20px;
		}
		#searchInput {
			width: 100%;
			padding: 12px;
			border: 1px solid #ddd;
			border-radius: 4px;
			font-size: 16px;
			box-sizing: border-box;
			margin-bottom: 20px;
		}
		#resultados {
			list-style: none;
			padding: 0;
			margin: 0;
		}
		.produto-item {
			padding: 15px;
			border-bottom: 1px solid #eee;
			transition: background-color 0.2s ease;
		}
		.produto-item:last-child {
			border-bottom: none;
		}
		.produto-item:hover {
			background-color: #f9f9f9;
		}
		.produto-modelo {
			font-weight: bold;
			font-size: 18px;
			color: #333;
			margin-bottom: 5px;
		}
		.produto-valor {
			font-size: 16px;
			color: #555;
			margin: 5px 0;
		}
		.sem-resultados {
			text-align: center;
			color: #888;
			font-style: italic;
			padding: 20px;
		}
	</style>
</head>
<body>
	<a href="index.html" class="btn btn-primary" style="margin: 20px;">
		<i class="fas fa-arrow-left" aria-hidden="true"></i>
		Voltar para o In√≠cio
	</a>
	
	<h1>Tabela de Pre√ßos</h1>
	<div class="container">
		<h1>Consulta de Pre√ßos de Produtos</h1>
		<p id="desconto-info"></p>
		<input type="text" id="searchInput" placeholder="Digite o modelo do produto...">
		<div id="resultados">
			<p class="sem-resultados">Nenhum produto encontrado. Digite para buscar.</p>
		</div>
	</div>
	<script>
		// URL da planilha publicada (CSV)
		const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTZn563fJoYnFQa2569Tj4aFmBdxmxmKQF3wUlPKEOeY1tQTOoHj18cMflnPx2ea4Q2cQeW13QShzHh/pub?output=csv";

		// üîß Percentual de desconto configur√°vel (ex.: 0.10 = 10%)
		//const descontoPercentual = 0.10;

		// Exibir desconto na tela
		//document.getElementById("desconto-info").innerText = 
			`üí∞ Desconto √† vista (${(descontoPercentual * 100).toFixed(0)}%) aplicado automaticamente nos pre√ßos.`;

		let produtos = [];

		const searchInput = document.getElementById('searchInput');
		const resultadosDiv = document.getElementById('resultados');

		function parseCSVLine(line) {
			const fields = [];
			let cur = '';
			let inQuotes = false;
			for (let i = 0; i < line.length; i++) {
				const ch = line[i];
				if (ch === '"') {
					if (inQuotes && line[i+1] === '"') { cur += '"'; i++; }
					else { inQuotes = !inQuotes; }
				} else if (ch === ',' && !inQuotes) {
					fields.push(cur);
					cur = '';
				} else {
					cur += ch;
				}
			}
			fields.push(cur);
			return fields;
		}

		function parsePriceNumber(raw) {
			if (!raw) return NaN;
			let s = String(raw).trim();
			s = s.replace(/\u00A0/g,''); 
			s = s.replace(/[^\d\.,-]/g, '');
			if (!s) return NaN;
			if (s.indexOf('.') !== -1 && s.indexOf(',') !== -1) {
				s = s.replace(/\./g, '').replace(',', '.');
			} else {
				s = s.replace(',', '.');
			}
			const n = parseFloat(s);
			return isFinite(n) ? n : NaN;
		}

		function formatBRL(value) {
			if (isNaN(value)) return '';
			return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
		}

		const displayResults = (results) => {
			resultadosDiv.innerHTML = '';
			if (results.length > 0) {
				results.forEach(produto => {
					const produtoItem = document.createElement('div');
					produtoItem.className = 'produto-item';
					produtoItem.innerHTML = `
						<div class="produto-modelo">${produto.modelo}</div>
						<div class="produto-valor">Pre√ßo de venda = ${produto.preco_venda}</div>
						//<div class="produto-valor">Desconto √† vista (${(descontoPercentual * 100).toFixed(0)}%) = ${produto.desconto_avista}</div>
					`;
					resultadosDiv.appendChild(produtoItem);
				});
			} else {
				resultadosDiv.innerHTML = '<p class="sem-resultados">Nenhum produto encontrado com este termo.</p>';
			}
		};

		async function carregarProdutos() {
			try {
				const resp = await fetch(url);
				if (!resp.ok) throw new Error('Erro ao buscar CSV: ' + resp.status);
				const csv = await resp.text();
				const linhas = csv.split(/\r?\n/).filter(l => l.trim() !== '');
				if (linhas.length === 0) {
					resultadosDiv.innerHTML = '<p class="sem-resultados">Planilha vazia.</p>';
					return;
				}

				let startIndex = 0;
				const firstCols = parseCSVLine(linhas[0]).map(c => (c||'').toString().toLowerCase());
				if (firstCols.some(c => /produto|modelo|preco|valor/.test(c))) {
					startIndex = 1;
				}

				const parsed = [];
				for (let i = startIndex; i < linhas.length; i++) {
					const cols = parseCSVLine(linhas[i]);
					const c0 = (cols[0] || '').trim().replace(/^"(.*)"$/,'$1');
					const c1 = (cols[1] || '').trim().replace(/^"(.*)"$/,'$1');

					if (!c0 && !c1) continue;

					const num = parsePriceNumber(c1);
					const precoVenda = isNaN(num) ? (c1 || '') : formatBRL(num);
					//const descontoAvista = isNaN(num) ? '' : formatBRL(num * (1 - descontoPercentual));

					parsed.push({
						modelo: c0,
						preco_venda: precoVenda,
						//desconto_avista: descontoAvista
					});
				}

				produtos = parsed;
				if (produtos.length > 0) displayResults(produtos);
				else resultadosDiv.innerHTML = '<p class="sem-resultados">Nenhum produto encontrado na planilha.</p>';

			} catch (err) {
				console.error('Erro ao carregar planilha:', err);
				resultadosDiv.innerHTML = '<p class="sem-resultados">Erro ao carregar planilha.</p>';
			}
		}

		searchInput.addEventListener('input', (e) => {
			const searchTerm = e.target.value.toLowerCase();
			if (searchTerm.length > 0) {
				const filteredProducts = produtos.filter(produto => 
					produto.modelo.toLowerCase().includes(searchTerm)
				);
				displayResults(filteredProducts);
			} else {
				resultadosDiv.innerHTML = '<p class="sem-resultados">Nenhum produto encontrado. Digite para buscar.</p>';
			}
		});

		carregarProdutos();
	</script>
</body>
</html>

