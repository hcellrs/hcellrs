<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Tabela de PreÃ§os - HCELL</title>

	<link rel="icon" type="image/x-icon" href="images/favicon.png">
	<link rel="stylesheet" href="style.css">
	<script defer src="script.js"></script>

	<style>
		/* ðŸ”¹ Complementos locais especÃ­ficos desta pÃ¡gina */
		.btn-container {
			text-align: center;
			margin-bottom: 25px;
		}
		.btn-fornecedor {
			padding: 10px 18px;
			margin: 5px;
			border: none;
			border-radius: 6px;
			cursor: pointer;
			font-size: 15px;
			color: #fff;
			font-weight: bold;
			transition: transform 0.2s, opacity 0.2s;
		}
		.btn-fornecedor:hover {
			transform: scale(1.05);
			opacity: 0.9;
		}
		.btn-lidercell { background-color: #ffcc00; color: #000; }
		.btn-goldcell { background-color: #d4af37; color: #000; }
		.btn-eletrocell { background-color: #007bff; }
		.btn-novapecas { background-color: #28a745; }
		.btn-ativo {
			outline: 3px solid var(--secondary-color, #1a73e8);
			box-shadow: 0 0 8px rgba(26,115,232,0.4);
			transform: scale(1.07);
		}
		#fornecedorAtual {
			text-align: center;
			font-weight: bold;
			font-size: 16px;
			color: var(--primary-color, #1a73e8);
			margin-top: 10px;
			margin-bottom: 15px;
		}
		/* ðŸ”¹ Texto pequeno do custo */
		.produto-custo {
			font-size: 8px;
			color: #888;
			margin-top: 2px;
		}
	</style>
</head>
<body>
	<a href="index.html" class="voltar">â¬… Voltar para o InÃ­cio</a>

	<h1>Tabela de PreÃ§os</h1>

	<div class="btn-container">
		<button class="btn-fornecedor btn-lidercell" onclick="selecionarFornecedor('lidercell', this)">Lidercell</button>
		<button class="btn-fornecedor btn-goldcell" onclick="selecionarFornecedor('goldcell', this)">Goldcell</button>
		<button class="btn-fornecedor btn-eletrocell" onclick="selecionarFornecedor('eletrocell', this)">Eletrocell</button>
		<button class="btn-fornecedor btn-novapecas" onclick="selecionarFornecedor('novapecas', this)">Nova PeÃ§as</button>
	</div>

	<div id="fornecedorAtual">Selecione um fornecedor para iniciar a consulta.</div>

	<div class="container">
		<h1>Consulta de PreÃ§os</h1>
		<input type="text" id="searchInput" placeholder="Digite o modelo do produto...">
		<div id="resultados">
			<p class="sem-resultados">Nenhum produto encontrado. Digite para buscar.</p>
		</div>
	</div>

	<script>
		const planilhas = {
			lidercell: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTZn563fJoYnFQa2569Tj4aFmBdxmxmKQF3wUlPKEOeY1tQTOoHj18cMflnPx2ea4Q2cQeW13QShzHh/pub?gid=0&single=true&output=csv",
			goldcell: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS0GfwlmUazjTIO8LDmn9XMnThhgbKdlqwFgHHvO4oCzUNPlebYbRjZRhv2iCRujK37P4KklsitoS--/pub?gid=0&single=true&output=csv",
			eletrocell: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTVODR_ZxfbJPiwXyXvTQLFboPiDvwy_32oUnLApVSxqNP_TIO4_tAELsBHELnQL4RXZlBOxkjp8Z-j/pub?gid=0&single=true&output=csv",
			novapecas: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQRCX7SYJFFUdD8QI3zPaq4QqSkzapv5y2R7KrXmqkYle-NqL_6n8bh9WatrzvhR_-aNW9jsj-Df2G-/pub?gid=0&single=true&output=csv"
		};

		let produtos = [];
		let fornecedorSelecionado = '';

		const searchInput = document.getElementById('searchInput');
		const resultadosDiv = document.getElementById('resultados');
		const fornecedorAtual = document.getElementById('fornecedorAtual');

		function parseCSVLine(line) {
			const fields = [];
			let cur = '';
			let inQuotes = false;
			for (let i = 0; i < line.length; i++) {
				const ch = line[i];
				if (ch === '"') {
					if (inQuotes && line[i+1] === '"') { cur += '"'; i++; }
					else { inQuotes = !inQuotes; }
				} else if (ch === ',' && !inQuotes) {
					fields.push(cur);
					cur = '';
				} else {
					cur += ch;
				}
			}
			fields.push(cur);
			return fields;
		}

		function parsePriceNumber(raw) {
			if (!raw) return NaN;
			let s = String(raw).trim();
			s = s.replace(/\u00A0/g,''); 
			s = s.replace(/[^\d\.,-]/g, '');
			if (!s) return NaN;
			if (s.indexOf('.') !== -1 && s.indexOf(',') !== -1) {
				s = s.replace(/\./g, '').replace(',', '.');
			} else {
				s = s.replace(',', '.');
			}
			const n = parseFloat(s);
			return isFinite(n) ? n : NaN;
		}

		function formatBRL(value) {
			if (isNaN(value)) return '';
			return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
		}

		function displayResults(results) {
			resultadosDiv.innerHTML = '';
			if (results.length > 0) {
				results.forEach(produto => {
					const produtoItem = document.createElement('div');
					produtoItem.className = 'produto-item';
					produtoItem.innerHTML = `
						ðŸ“Œ ${produto.modelo} <strong style="color:#28a745">${produto.preco_venda}</strong>
						${produto.preco_custo ? `<div class="produto-custo">ðŸ’° Custo: ${produto.preco_custo}</div>` : ''}
					`;
					resultadosDiv.appendChild(produtoItem);
				});
			} else {
				resultadosDiv.innerHTML = '<p class="sem-resultados">Nenhum produto encontrado com este termo.</p>';
			}
		}

		async function carregarProdutos(url) {
			try {
				const resp = await fetch(url);
				if (!resp.ok) throw new Error('Erro ao buscar CSV: ' + resp.status);
				const csv = await resp.text();
				const linhas = csv.split(/\r?\n/).filter(l => l.trim() !== '');
				if (linhas.length === 0) {
					resultadosDiv.innerHTML = '<p class="sem-resultados">Planilha vazia.</p>';
					return;
				}

				let startIndex = 0;
				const firstCols = parseCSVLine(linhas[0]).map(c => (c||'').toString().toLowerCase());
				if (firstCols.some(c => /produto|modelo|preco|valor/.test(c))) {
					startIndex = 1;
				}

				const parsed = [];
				for (let i = startIndex; i < linhas.length; i++) {
					const cols = parseCSVLine(linhas[i]);
					const c0 = (cols[0] || '').trim().replace(/^"(.*)"$/,'$1'); // produto
					const c1 = (cols[1] || '').trim().replace(/^"(.*)"$/,'$1'); // venda
					const c2 = (cols[2] || '').trim().replace(/^"(.*)"$/,'$1'); // custo

					if (!c0 && !c1) continue;

					const numVenda = parsePriceNumber(c1);
					const precoVenda = isNaN(numVenda) ? (c1 || '') : formatBRL(numVenda);

					const numCusto = parsePriceNumber(c2);
					const precoCusto = isNaN(numCusto) ? '' : formatBRL(numCusto);

					parsed.push({
						modelo: c0,
						preco_venda: precoVenda,
						preco_custo: precoCusto
					});
				}

				produtos = parsed;
				resultadosDiv.innerHTML = '<p class="sem-resultados">Nenhum produto encontrado. Digite para buscar.</p>';
			} catch (err) {
				console.error('Erro ao carregar planilha:', err);
				resultadosDiv.innerHTML = '<p class="sem-resultados">Erro ao carregar planilha.</p>';
			}
		}

		function selecionarFornecedor(nome, botao) {
			const url = planilhas[nome];
			if (!url) {
				alert("Link da planilha nÃ£o configurado para " + nome);
				return;
			}

			document.querySelectorAll('.btn-fornecedor').forEach(btn => btn.classList.remove('btn-ativo'));
			botao.classList.add('btn-ativo');

			fornecedorSelecionado = botao.innerText;
			fornecedorAtual.textContent = "Consulta atual: " + fornecedorSelecionado;

			carregarProdutos(url);
			searchInput.value = '';
			resultadosDiv.innerHTML = '<p class="sem-resultados">Nenhum produto encontrado. Digite para buscar.</p>';
		}

		searchInput.addEventListener('input', (e) => {
			const searchTerm = e.target.value.toLowerCase();
			if (searchTerm.length > 0) {
				const filtered = produtos.filter(produto => produto.modelo.toLowerCase().includes(searchTerm));
				displayResults(filtered);
			} else {
				resultadosDiv.innerHTML = '<p class="sem-resultados">Nenhum produto encontrado. Digite para buscar.</p>';
			}
		});
	</script>
</body>
</html>
